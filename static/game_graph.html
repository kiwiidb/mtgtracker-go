<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Life Totals Over Time</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.umd.min.js"></script>

  <style>
    canvas {
      max-width: 1400px;
      height: 600px;
      margin: 50px auto;
      display: block;
      background: #23233a;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    }
    body {
      background: #181828;
    }
  </style>
</head>
<body>
  <canvas id="lifeChart"></canvas>

  <script>
    const rawData = [
      { CreatedAt: "2025-05-21T19:29:37.739788Z", TargetLifeTotalAfter: 37, TargetRankingID: 37 },
      { CreatedAt: "2025-05-21T19:29:39.070784Z", TargetLifeTotalAfter: 25, TargetRankingID: 36 },
      { CreatedAt: "2025-05-21T19:29:41.356914Z", TargetLifeTotalAfter: 34, TargetRankingID: 38 },
      { CreatedAt: "2025-05-21T19:29:43.617047Z", TargetLifeTotalAfter: 31, TargetRankingID: 37 },
      { CreatedAt: "2025-05-21T19:29:44.872977Z", TargetLifeTotalAfter: 23, TargetRankingID: 37 },
      { CreatedAt: "2025-05-21T19:29:46.129237Z", TargetLifeTotalAfter: 11, TargetRankingID: 36 },
      { CreatedAt: "2025-05-21T19:29:47.381929Z", TargetLifeTotalAfter: 5, TargetRankingID: 37 },
      { CreatedAt: "2025-05-21T19:29:49.636161Z", TargetLifeTotalAfter: 4, TargetRankingID: 37 },
      { CreatedAt: "2025-05-21T19:29:50.891677Z", TargetLifeTotalAfter: 10, TargetRankingID: 36 },
      { CreatedAt: "2025-05-21T19:29:53.15165Z", TargetLifeTotalAfter: 30, TargetRankingID: 38 },
      { CreatedAt: "2025-05-21T19:29:54.509971Z", TargetLifeTotalAfter: 3, TargetRankingID: 36 },
      { CreatedAt: "2025-05-21T19:29:56.754831Z", TargetLifeTotalAfter: 0, TargetRankingID: 37 },
      { CreatedAt: "2025-05-21T19:29:59.003282Z", TargetLifeTotalAfter: 0, TargetRankingID: 36 }
    ];

    const groupedData = {};
    rawData.forEach(({ CreatedAt, TargetLifeTotalAfter, TargetRankingID }) => {
      const time = new Date(CreatedAt).toISOString();
      if (!groupedData[TargetRankingID]) groupedData[TargetRankingID] = [];
      groupedData[TargetRankingID].push({ x: time, y: TargetLifeTotalAfter });
    });

    const colors = [
      'rgba(255,99,132,0.9)',
      'rgba(54,162,235,0.9)',
      'rgba(75,192,192,0.9)',
      'rgba(255,206,86,0.9)',
      'rgba(153,102,255,0.9)'
    ];
    const pointColors = [
      'rgba(255,99,132,1)',
      'rgba(54,162,235,1)',
      'rgba(75,192,192,1)',
      'rgba(255,206,86,1)',
      'rgba(153,102,255,1)'
    ];
    const datasets = Object.entries(groupedData).map(([rankingID, data], index) => ({
      data,
      label: `Player ${index + 1}`,
      fill: false,
      borderColor: colors[index % colors.length],
      backgroundColor: colors[index % colors.length],
      pointBackgroundColor: pointColors[index % pointColors.length],
      pointBorderColor: "#fff",
      pointRadius: 5,
      pointHoverRadius: 8,
      borderWidth: 4,
      tension: 0.4,
      cubicInterpolationMode: 'monotone'
    }));

    new Chart(document.getElementById('lifeChart'), {
      type: 'line',
      data: {
        datasets
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: '#23233a',
            titleColor: '#ffd700',
            bodyColor: '#fff',
            borderColor: '#ffd700',
            borderWidth: 1,
            padding: 12,
            callbacks: {
              label: function(context) {
                return `Life: ${context.parsed.y}`;
              }
            }
          },
          title: {
            display: true,
            text: 'Player Life Totals Over Time',
            color: '#ffd700',
            font: {
              size: 28,
              weight: 'bold'
            },
            padding: {
              top: 20,
              bottom: 30
            }
          }
        },
        layout: {
          padding: 30
        },
        scales: {
          x: {
            type: 'time',
            time: {
              tooltipFormat: 'HH:mm:ss',
              displayFormats: {
                second: 'HH:mm:ss'
              }
            },
            grid: {
              color: '#33334d'
            },
            ticks: {
              color: '#fff',
              font: {
                size: 16
              }
            }
          },
          y: {
            beginAtZero: true,
            grid: {
              color: '#33334d'
            },
            ticks: {
              color: '#fff',
              font: {
                size: 16
              }
            }
          }
        }
      }
    });
  </script>
</body>
</html>
